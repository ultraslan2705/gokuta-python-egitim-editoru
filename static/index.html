<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gokuta Python Eğitim Editörü</title>
    <style>
      :root {
        --bg-1: #f8efe1;
        --bg-2: #d9ecff;
        --panel: #fffdf7cc;
        --panel-strong: #ffffffee;
        --panel-2: #f2f8ff;
        --text: #13263a;
        --muted: #4e6074;
        --accent: #0a6f87;
        --accent-strong: #064a67;
        --error: #a32020;
        --border: #c8d7e6;
        --shadow: 0 20px 45px rgba(10, 30, 50, 0.12);
        --gutter-width: 44px;
        --editor-font-size: 0.98rem;
        --editor-line-height: 1.5;
      }

      * {
        box-sizing: border-box;
      }

      html {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Avenir Next", "Segoe UI Variable Text", "Trebuchet MS", sans-serif;
        color: var(--text);
        overflow: hidden;
        background:
          radial-gradient(circle at 8% 6%, #fff7dc 0%, transparent 42%),
          radial-gradient(circle at 92% 4%, #d7f0ff 0%, transparent 46%),
          linear-gradient(145deg, var(--bg-1) 0%, var(--bg-2) 100%);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image: linear-gradient(
          to right,
          rgba(255, 255, 255, 0.2) 1px,
          transparent 1px
        );
        background-size: 42px 42px;
        opacity: 0.18;
      }

      .app-header {
        width: min(1100px, calc(100% - 28px));
        margin: 0 auto;
        padding: 12px 0 6px;
        text-align: center;
        position: relative;
      }

      .app-kicker {
        margin: 0 0 8px 0;
        color: #215069;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.14em;
        text-transform: uppercase;
      }

      .app-title {
        margin: 0;
        font-family: "Avenir Next Condensed", "Gill Sans", "Trebuchet MS", sans-serif;
        font-size: clamp(1.35rem, 2.6vw, 2.05rem);
        line-height: 1.2;
        color: #14354f;
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.45);
      }

      .layout {
        width: min(1100px, calc(100% - 28px));
        margin: 0 auto 10px auto;
        height: calc(100dvh - 102px);
        min-height: 0;
        display: grid;
        grid-template-rows: minmax(0, 1fr) minmax(0, 1fr);
        gap: 14px;
        position: relative;
      }

      .panel {
        background: linear-gradient(170deg, var(--panel-strong) 0%, var(--panel) 100%);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 14px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(4px);
        animation: rise-in 420ms ease both;
      }

      .output-panel {
        animation-delay: 80ms;
      }

      .editor-panel,
      .output-panel {
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .editor-body,
      .output-body {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
        min-height: 0;
      }

      .panel h2 {
        margin: 0;
        font-size: 1.05rem;
        letter-spacing: 0.02em;
        color: #11324a;
      }

      .hint {
        margin: 8px 0 12px 0;
        font-size: 0.93rem;
        color: var(--muted);
        line-height: 1.4;
      }

      .example-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 7px;
      }

      .example-btn {
        border: 1px solid #d1deeb;
        background: #f2f8ff;
        color: #1f3f57;
        border-radius: 999px;
        padding: 5px 10px;
        font-size: 0.78rem;
        font-weight: 700;
        cursor: pointer;
      }

      #code {
        position: absolute;
        inset: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 12px 12px calc(var(--gutter-width) + 10px);
        font-family: "Courier New", Courier, monospace;
        font-size: var(--editor-font-size);
        line-height: var(--editor-line-height);
        resize: none;
        overflow: auto;
        white-space: pre;
        tab-size: 4;
        outline: none;
        color: transparent;
        caret-color: var(--text);
        background: transparent;
      }

      #code::selection {
        background: rgba(10, 111, 135, 0.25);
        color: transparent;
      }

      .code-editor {
        position: relative;
        flex: 1;
        min-height: 0;
      }

      #highlighting {
        position: absolute;
        inset: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 12px 12px calc(var(--gutter-width) + 10px);
        overflow: auto;
        pointer-events: none;
        white-space: pre;
        tab-size: 4;
        background: linear-gradient(180deg, #fffefb, #f8fbff);
      }

      #highlighting-content {
        display: block;
        min-height: 100%;
        margin: 0;
        font-family: "Courier New", Courier, monospace;
        font-size: var(--editor-font-size);
        line-height: var(--editor-line-height);
        color: var(--text);
      }

      #line-numbers {
        position: absolute;
        top: 1px;
        bottom: 1px;
        left: 1px;
        width: var(--gutter-width);
        border-right: 1px solid #d8e5f2;
        border-radius: 11px 0 0 11px;
        background: #f4f9ff;
        overflow: hidden;
        pointer-events: none;
        z-index: 2;
      }

      #line-numbers-content {
        padding: 12px 8px 12px 0;
        font-family: "Courier New", Courier, monospace;
        font-size: 0.82rem;
        line-height: var(--editor-line-height);
        color: #7a8da1;
        text-align: right;
        white-space: pre;
      }

      .line-number {
        display: block;
      }

      .line-number.active {
        color: #0a6f87;
        font-weight: 700;
      }

      #active-line {
        position: absolute;
        left: calc(var(--gutter-width) + 2px);
        right: 2px;
        height: 0;
        border-radius: 6px;
        background: rgba(10, 111, 135, 0.06);
        pointer-events: none;
        z-index: 1;
        display: none;
      }

      .token-keyword {
        color: #0057b8;
        font-weight: 700;
      }

      .token-string {
        color: #8b5b00;
      }

      .token-number {
        color: #0b7769;
      }

      .token-comment {
        color: #596576;
        font-style: italic;
      }

      .token-builtin {
        color: #a7162f;
      }

      .actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
      }

      #run,
      #clear-output,
      #clear-code,
      #reset-all {
        border: 1px solid transparent;
        border-radius: 12px;
        padding: 10px 17px;
        font-size: 0.94rem;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
      }

      #run {
        color: #ffffff;
        background: linear-gradient(140deg, var(--accent), var(--accent-strong));
        box-shadow: 0 10px 20px rgba(6, 74, 103, 0.25);
      }

      #clear-output {
        color: #2a3f53;
        background: #f3f7fb;
        border-color: #d6e0ea;
      }

      #clear-code {
        color: #2a3f53;
        background: #f3f7fb;
        border-color: #d6e0ea;
      }

      #reset-all {
        color: #2a3f53;
        background: #f3f7fb;
        border-color: #d6e0ea;
      }

      #run:hover,
      #clear-output:hover,
      #clear-code:hover,
      #reset-all:hover {
        transform: translateY(-1px);
      }

      #run:active,
      #clear-output:active,
      #clear-code:active,
      #reset-all:active {
        transform: translateY(0);
      }

      #run:disabled {
        opacity: 0.68;
        cursor: progress;
        transform: none;
      }

      #output {
        margin: 0;
        height: auto;
        min-height: 0;
        flex: 1;
        overflow: auto;
        padding: 12px;
        border: 1px solid #cddceb;
        border-radius: 12px;
        background: linear-gradient(180deg, #fbfdff, var(--panel-2));
        font-family: "Courier New", Courier, monospace;
        line-height: 1.45;
        white-space: pre-wrap;
      }

      #output.error {
        color: var(--error);
        background: #fff3f3;
        border-color: #efc6c6;
      }

      .help-card {
        border: 1px solid #ffd8a8;
        background: #fff8ec;
        border-radius: 12px;
        padding: 10px 12px;
      }

      .help-card[hidden] {
        display: none;
      }

      .help-title {
        margin: 0 0 6px 0;
        font-size: 0.95rem;
        color: #6a3b00;
      }

      .help-line {
        margin: 0;
        font-size: 0.88rem;
        line-height: 1.35;
      }

      .help-line + .help-line {
        margin-top: 5px;
      }

      .input-modal {
        position: fixed;
        inset: 0;
        background: rgba(6, 20, 30, 0.46);
        display: grid;
        place-items: center;
        padding: 18px;
        z-index: 30;
      }

      .input-modal[hidden] {
        display: none;
      }

      .input-modal-card {
        width: min(440px, 96vw);
        background: #fffefb;
        border: 1px solid #d7e3ef;
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 24px 60px rgba(4, 18, 28, 0.32);
      }

      .input-modal-title {
        margin: 0 0 10px 0;
        font-size: 1rem;
        color: #173952;
      }

      #input-modal-field {
        width: 100%;
        border: 1px solid #c7d8e8;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 0.95rem;
      }

      .input-modal-actions {
        margin-top: 10px;
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      #input-cancel,
      #input-ok {
        border-radius: 10px;
        border: 1px solid transparent;
        padding: 7px 12px;
        font-size: 0.86rem;
        font-weight: 700;
        cursor: pointer;
      }

      #input-cancel {
        background: #eef4fb;
        border-color: #d5e1ee;
        color: #2a3f53;
      }

      #input-ok {
        background: linear-gradient(140deg, var(--accent), var(--accent-strong));
        color: #ffffff;
      }

      @keyframes rise-in {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 760px) {
        :root {
          --editor-font-size: 0.84rem;
        }

        .app-header {
          width: calc(100% - 24px);
          padding: 10px 0 4px;
        }

        .app-kicker {
          margin-bottom: 4px;
          font-size: 0.62rem;
          letter-spacing: 0.1em;
        }

        .app-title {
          font-size: clamp(1.16rem, 6vw, 1.42rem);
        }

        .layout {
          width: calc(100% - 24px);
          margin: 0 auto 8px auto;
          min-height: calc(100dvh - 82px);
          height: calc(100dvh - 82px);
          grid-template-rows: minmax(0, 1fr) minmax(0, 1fr);
          gap: 8px;
        }

        .panel {
          border-radius: 14px;
          padding: 10px;
        }

        .panel h2 {
          font-size: 0.92rem;
        }

        .hint {
          margin: 4px 0 10px 0;
          font-size: 0.82rem;
          line-height: 1.3;
        }

        .example-strip {
          display: grid;
          grid-template-columns: repeat(3, minmax(0, 1fr));
          gap: 5px;
        }

        .example-btn {
          width: 100%;
          padding: 4px 6px;
          font-size: 0.7rem;
          text-align: center;
        }

        .code-editor,
        #output {
          min-height: 0;
        }

        #code,
        #highlighting {
          padding: 9px 9px 9px calc(var(--gutter-width) + 8px);
        }

        #output {
          padding: 9px;
          font-size: 0.84rem;
        }

        #line-numbers-content {
          padding: 9px 6px 9px 0;
          font-size: 0.72rem;
        }

        .actions {
          gap: 6px;
        }

        #run,
        #clear-output,
        #clear-code,
        #reset-all {
          border-radius: 10px;
          padding: 6px 11px;
          font-size: 0.8rem;
        }

        .help-card {
          padding: 8px 9px;
        }

        .help-title {
          font-size: 0.83rem;
        }

        .help-line {
          font-size: 0.77rem;
        }

        .input-modal-card {
          width: min(420px, 100%);
          padding: 11px;
        }

        .input-modal-title {
          font-size: 0.9rem;
        }

        #input-modal-field {
          font-size: 0.85rem;
          padding: 8px 10px;
        }

        #input-cancel,
        #input-ok {
          padding: 6px 10px;
          font-size: 0.8rem;
        }
      }

      @media (hover: none) and (pointer: coarse) {
        :root {
          --gutter-width: 34px;
        }

        body.mobile-plain-edit #code {
          font-size: 16px;
          line-height: 1.5;
          color: var(--text);
          background: linear-gradient(180deg, #fffefb, #f8fbff);
        }

        body.mobile-plain-edit #highlighting {
          display: none;
        }

        body.mobile-plain-edit #code::selection {
          color: var(--text);
        }

        body.mobile-plain-edit #line-numbers {
          opacity: 0.85;
        }
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <p class="app-kicker">Canlı Kod Atölyesi</p>
      <h1 class="app-title">Gokuta Python Eğitim Editörü</h1>
    </header>
    <main class="layout">
      <section class="panel editor-panel">
        <h2>Python Kod Alanı</h2>
        <p class="hint">Yukarıdaki alana kod yazıp aşağıdaki butonla çalıştırabilirsin.</p>
        <div id="example-strip" class="example-strip"></div>
        <div class="editor-body">
          <div class="code-editor">
            <div id="active-line"></div>
            <div id="line-numbers" aria-hidden="true"><div id="line-numbers-content"></div></div>
            <pre id="highlighting" aria-hidden="true"><code id="highlighting-content"></code></pre>
            <textarea id="code" spellcheck="false" wrap="off" autocapitalize="off" autocorrect="off" autocomplete="off">
print("Gökçe KIRCALI")
            </textarea>
          </div>
          <div class="actions">
            <button id="clear-code" type="button">Kodu Temizle</button>
            <button id="reset-all" type="button">Sıfırla</button>
            <button id="run" type="button">Çalıştır</button>
          </div>
        </div>
      </section>

      <section class="panel output-panel">
        <h2>Çıktı</h2>
        <div class="output-body">
          <pre id="output">Sonuç burada görünecek.</pre>
          <section id="help-card" class="help-card" hidden>
            <h3 id="help-title" class="help-title">Öğretici İpucu</h3>
            <p class="help-line"><strong>Neden:</strong> <span id="help-why"></span></p>
            <p class="help-line"><strong>Çözüm:</strong> <span id="help-fix"></span></p>
            <p class="help-line"><strong>Mini Örnek:</strong> <span id="help-example"></span></p>
          </section>
          <div class="actions">
            <button id="clear-output" type="button">Temizle</button>
          </div>
        </div>
      </section>
    </main>

    <section id="input-modal" class="input-modal" hidden>
      <div class="input-modal-card">
        <p id="input-modal-title" class="input-modal-title">Bir değer giriniz:</p>
        <input id="input-modal-field" type="text" spellcheck="false" />
        <div class="input-modal-actions">
          <button id="input-cancel" type="button">İptal</button>
          <button id="input-ok" type="button">Tamam</button>
        </div>
      </div>
    </section>

    <script>
      const codeInput = document.getElementById("code");
      const lineNumbersContent = document.getElementById("line-numbers-content");
      const activeLine = document.getElementById("active-line");
      const highlighting = document.getElementById("highlighting");
      const highlightingContent = document.getElementById("highlighting-content");
      const exampleStrip = document.getElementById("example-strip");
      const clearCodeButton = document.getElementById("clear-code");
      const resetAllButton = document.getElementById("reset-all");
      const runButton = document.getElementById("run");
      const clearOutputButton = document.getElementById("clear-output");
      const output = document.getElementById("output");
      const helpCard = document.getElementById("help-card");
      const helpTitle = document.getElementById("help-title");
      const helpWhy = document.getElementById("help-why");
      const helpFix = document.getElementById("help-fix");
      const helpExample = document.getElementById("help-example");
      const inputModal = document.getElementById("input-modal");
      const inputModalTitle = document.getElementById("input-modal-title");
      const inputModalField = document.getElementById("input-modal-field");
      const inputOkButton = document.getElementById("input-ok");
      const inputCancelButton = document.getElementById("input-cancel");
      const isCoarsePointer = window.matchMedia("(hover: none) and (pointer: coarse)").matches;
      let defaultCode = "";
      let inputResolver = null;
      const EXAMPLES = [
        {
          label: "Değişken",
          code: 'ad = "Ahmet"\nyas = 15\nprint(ad, yas)',
        },
        {
          label: "Print",
          code: 'print("Merhaba Dünya")',
        },
        {
          label: "Formatlı Yazım",
          code: 'ad = "Ahmet"\nyas = 15\nprint(f"Adınız {ad}, yaşınız {yas}")',
        },
        {
          label: "Input",
          code: 'sayi = int(input("Bir sayı giriniz : "))\nprint(sayi)',
        },
        {
          label: "if-else",
          code: 'notu = int(input("Not giriniz : "))\nif notu >= 50:\n    print("Geçti")\nelse:\n    print("Kaldı")',
        },
        {
          label: "for",
          code: "for i in range(1, 6):\n    print(i)",
        },
        {
          label: "while",
          code: "sayac = 1\nwhile sayac <= 5:\n    print(sayac)\n    sayac += 1",
        },
        {
          label: "Collections",
          code: 'liste = ["elma", "armut", "muz"]\ntuple_veri = ("kırmızı", "mavi", "yeşil")\nset_veri = {"kalem", "defter", "silgi"}\n\nprint("Liste:", liste)\nprint("Tuple:", tuple_veri)\nprint("Set:", sorted(set_veri))',
        },
        {
          label: "Fonksiyon",
          code: "def kare(sayi):\n    return sayi * sayi\n\nprint(kare(6))",
        },
      ];

      function escapeHtml(value) {
        return value
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      function highlightPythonCode(source) {
        let html = escapeHtml(source);
        const placeholders = [];

        const protect = (regex, className) => {
          html = html.replace(regex, (match) => {
            const token = `__PY_TOKEN_${placeholders.length}__`;
            placeholders.push(`<span class="${className}">${match}</span>`);
            return token;
          });
        };

        protect(
          /("""[\s\S]*?"""|'''[\s\S]*?'''|"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*')/g,
          "token-string"
        );
        protect(/(#.*)$/gm, "token-comment");

        html = html.replace(
          /\b(False|None|True|and|as|assert|async|await|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g,
          '<span class="token-keyword">$1</span>'
        );
        html = html.replace(
          /\b(print|range|len|input|int|float|str|list|dict|set|tuple|bool|enumerate|sum|min|max)\b/g,
          '<span class="token-builtin">$1</span>'
        );
        html = html.replace(/\b(\d+(?:\.\d+)?)\b/g, '<span class="token-number">$1</span>');
        html = html.replace(/__PY_TOKEN_(\d+)__/g, (_match, idx) => placeholders[Number(idx)]);

        if (html.endsWith("\n")) {
          html += " ";
        }

        return html;
      }

      function syncEditorScroll() {
        highlighting.scrollTop = codeInput.scrollTop;
        highlighting.scrollLeft = codeInput.scrollLeft;
        lineNumbersContent.style.transform = `translateY(${-codeInput.scrollTop}px)`;
      }

      function renderHighlighting() {
        highlightingContent.innerHTML = highlightPythonCode(codeInput.value);
        syncEditorScroll();
      }

      function currentLineNumber() {
        return codeInput.value.slice(0, codeInput.selectionStart).split("\n").length;
      }

      function renderLineNumbers() {
        const totalLines = codeInput.value.split("\n").length;
        const active = currentLineNumber();
        const rows = [];
        for (let i = 1; i <= totalLines; i += 1) {
          rows.push(`<span class="line-number${i === active ? " active" : ""}">${i}</span>`);
        }
        lineNumbersContent.innerHTML = rows.join("");
        lineNumbersContent.style.transform = `translateY(${-codeInput.scrollTop}px)`;
      }

      function updateActiveLineMarker() {
        const lineHeight = parseFloat(getComputedStyle(codeInput).lineHeight) || 22;
        const paddingTop = parseFloat(getComputedStyle(codeInput).paddingTop) || 0;
        const top = paddingTop + (currentLineNumber() - 1) * lineHeight - codeInput.scrollTop;
        if (top + lineHeight < 0 || top > codeInput.clientHeight) {
          activeLine.style.display = "none";
          return;
        }
        activeLine.style.display = "block";
        activeLine.style.top = `${Math.max(1, top)}px`;
        activeLine.style.height = `${lineHeight}px`;
      }

      function refreshEditorMeta() {
        renderLineNumbers();
        updateActiveLineMarker();
      }

      function refreshEditorLayout() {
        window.requestAnimationFrame(() => {
          syncEditorScroll();
          refreshEditorMeta();
        });
      }

      function hideHelpCard() {
        helpCard.hidden = true;
      }

      function showHelpCard(help, errorType) {
        if (!help) {
          hideHelpCard();
          return;
        }
        helpTitle.textContent = `Öğretici İpucu (${errorType || "Hata"})`;
        helpWhy.textContent = help.why || "Hatanın nedeni bulunamadı.";
        helpFix.textContent = help.fix || "Kodu adım adım kontrol et.";
        helpExample.textContent = help.example || "print(\"Merhaba\")";
        helpCard.hidden = false;
      }

      function loadExample(exampleCode) {
        codeInput.value = exampleCode;
        hideHelpCard();
        output.classList.remove("error");
        output.textContent = "Sonuç burada görünecek.";
        renderHighlighting();
        codeInput.focus();
      }

      function renderExampleButtons() {
        for (const item of EXAMPLES) {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "example-btn";
          btn.textContent = item.label;
          btn.addEventListener("click", () => loadExample(item.code));
          exampleStrip.appendChild(btn);
        }
      }

      function closeInputModal(value) {
        if (!inputResolver) return;
        inputModal.hidden = true;
        const resolver = inputResolver;
        inputResolver = null;
        resolver(value);
      }

      function askInputValue(promptText) {
        return new Promise((resolve) => {
          inputResolver = resolve;
          inputModalTitle.textContent = promptText || "Bir değer giriniz:";
          inputModalField.value = "";
          inputModal.hidden = false;
          window.setTimeout(() => {
            inputModalField.focus();
            inputModalField.select();
          }, 0);
        });
      }

      function extractInputPrompts(source) {
        const prompts = [];
        const regex = /\binput\s*\(\s*(?:(["'])(.*?)\1)?\s*\)/g;
        let match;
        while ((match = regex.exec(source)) !== null) {
          const rawPrompt = (match[2] || "").replace(/\\n/g, "\n").trim();
          prompts.push(rawPrompt || "Bir değer giriniz:");
        }
        return prompts;
      }

      async function collectStdinFromPrompts(prompts) {
        if (prompts.length === 0) return "";
        const values = [];
        for (const prompt of prompts) {
          const answer = await askInputValue(prompt);
          if (answer === null) return null;
          values.push(answer.trim() === "" ? "0" : answer);
        }
        return `${values.join("\n")}\n`;
      }

      async function runCode() {
        const code = codeInput.value;
        runButton.disabled = true;
        hideHelpCard();
        output.classList.remove("error");
        output.textContent = "Kod çalıştırılıyor...";

        try {
          const prompts = extractInputPrompts(code);
          const stdin = await collectStdinFromPrompts(prompts);
          if (stdin === null) {
            output.textContent = "Çalıştırma iptal edildi.";
            return;
          }
          const response = await fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code, stdin }),
          });

          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || "İstek başarısız.");
          }

          if (data.ok) {
            output.classList.remove("error");
            output.textContent = data.output;
            hideHelpCard();
          } else {
            output.classList.add("error");
            const lines = [];
            if (data.output) lines.push(data.output);
            if (data.error) lines.push(data.error);
            output.textContent = lines.join("\n\n") || "Bir hata oluştu.";
            showHelpCard(data.help, data.error_type);
          }
        } catch (error) {
          output.classList.add("error");
          output.textContent = `Hata: ${error.message}`;
          showHelpCard(null, "");
        } finally {
          runButton.disabled = false;
        }
      }

      runButton.addEventListener("click", runCode);
      codeInput.addEventListener("input", () => {
        renderHighlighting();
        refreshEditorMeta();
      });
      codeInput.addEventListener("scroll", () => {
        syncEditorScroll();
        updateActiveLineMarker();
      });
      codeInput.addEventListener("click", refreshEditorMeta);
      codeInput.addEventListener("keyup", refreshEditorMeta);
      codeInput.addEventListener("select", refreshEditorMeta);
      if (isCoarsePointer) {
        codeInput.addEventListener("focus", () => {
          document.body.classList.add("mobile-plain-edit");
          refreshEditorLayout();
          window.setTimeout(refreshEditorLayout, 120);
        });
        codeInput.addEventListener("blur", () => {
          document.body.classList.remove("mobile-plain-edit");
          renderHighlighting();
          refreshEditorLayout();
        });
      }
      codeInput.addEventListener("keydown", (event) => {
        if (event.key !== "Tab") return;
        event.preventDefault();
        const start = codeInput.selectionStart;
        const end = codeInput.selectionEnd;
        const value = codeInput.value;
        codeInput.value = `${value.slice(0, start)}    ${value.slice(end)}`;
        codeInput.selectionStart = codeInput.selectionEnd = start + 4;
        renderHighlighting();
        refreshEditorMeta();
      });
      clearCodeButton.addEventListener("click", () => {
        codeInput.value = "";
        hideHelpCard();
        renderHighlighting();
        refreshEditorMeta();
        codeInput.focus();
      });
      resetAllButton.addEventListener("click", () => {
        codeInput.value = defaultCode;
        hideHelpCard();
        output.classList.remove("error");
        output.textContent = "Sonuç burada görünecek.";
        renderHighlighting();
        refreshEditorMeta();
        codeInput.focus();
      });
      clearOutputButton.addEventListener("click", () => {
        hideHelpCard();
        output.classList.remove("error");
        output.textContent = "Sonuç burada görünecek.";
      });
      inputOkButton.addEventListener("click", () => closeInputModal(inputModalField.value));
      inputCancelButton.addEventListener("click", () => closeInputModal(null));
      inputModalField.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          event.preventDefault();
          closeInputModal(inputModalField.value);
        } else if (event.key === "Escape") {
          event.preventDefault();
          closeInputModal(null);
        }
      });
      inputModal.addEventListener("click", (event) => {
        if (event.target === inputModal) closeInputModal(null);
      });
      window.addEventListener("resize", refreshEditorLayout);
      window.addEventListener("orientationchange", refreshEditorLayout);
      if (window.visualViewport) {
        window.visualViewport.addEventListener("resize", refreshEditorLayout);
      }
      codeInput.value = codeInput.value.replace(/^\n/, "").replace(/\n\s*$/, "");
      defaultCode = codeInput.value;
      renderExampleButtons();
      renderHighlighting();
      refreshEditorMeta();
    </script>
  </body>
</html>
