<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gokuta Python Eğitim Editörü</title>
    <style>
      :root {
        --bg-1: #f8efe1;
        --bg-2: #d9ecff;
        --panel: #fffdf7cc;
        --panel-strong: #ffffffee;
        --panel-2: #f2f8ff;
        --text: #13263a;
        --muted: #4e6074;
        --accent: #0a6f87;
        --accent-strong: #064a67;
        --error: #a32020;
        --border: #c8d7e6;
        --shadow: 0 20px 45px rgba(10, 30, 50, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Avenir Next", "Segoe UI Variable Text", "Trebuchet MS", sans-serif;
        color: var(--text);
        background:
          radial-gradient(circle at 8% 6%, #fff7dc 0%, transparent 42%),
          radial-gradient(circle at 92% 4%, #d7f0ff 0%, transparent 46%),
          linear-gradient(145deg, var(--bg-1) 0%, var(--bg-2) 100%);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image: linear-gradient(
          to right,
          rgba(255, 255, 255, 0.2) 1px,
          transparent 1px
        );
        background-size: 42px 42px;
        opacity: 0.18;
      }

      .app-header {
        width: min(1100px, calc(100% - 28px));
        margin: 0 auto;
        padding: 18px 0 8px;
        text-align: center;
        position: relative;
      }

      .app-kicker {
        margin: 0 0 8px 0;
        color: #215069;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.14em;
        text-transform: uppercase;
      }

      .app-title {
        margin: 0;
        font-family: "Avenir Next Condensed", "Gill Sans", "Trebuchet MS", sans-serif;
        font-size: clamp(1.35rem, 2.6vw, 2.05rem);
        line-height: 1.2;
        color: #14354f;
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.45);
      }

      .layout {
        width: min(1100px, calc(100% - 28px));
        margin: 0 auto 16px auto;
        min-height: calc(100vh - 132px);
        display: grid;
        grid-template-rows: minmax(320px, 1fr) minmax(250px, 1fr);
        gap: 14px;
        position: relative;
      }

      .panel {
        background: linear-gradient(170deg, var(--panel-strong) 0%, var(--panel) 100%);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 14px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(4px);
        animation: rise-in 420ms ease both;
      }

      .output-panel {
        animation-delay: 80ms;
      }

      .editor-panel,
      .output-panel {
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .editor-body,
      .output-body {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
        min-height: 0;
      }

      .panel h2 {
        margin: 0;
        font-size: 1.05rem;
        letter-spacing: 0.02em;
        color: #11324a;
      }

      .hint {
        margin: 8px 0 0 0;
        font-size: 0.95rem;
        color: var(--muted);
        line-height: 1.4;
      }

      #code {
        position: absolute;
        inset: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        font-family: "Courier New", Courier, monospace;
        font-size: 0.98rem;
        line-height: 1.5;
        resize: none;
        overflow: auto;
        white-space: pre;
        tab-size: 4;
        outline: none;
        color: transparent;
        caret-color: var(--text);
        background: transparent;
      }

      #code::selection {
        background: rgba(10, 111, 135, 0.25);
        color: transparent;
      }

      .code-editor {
        position: relative;
        flex: 1;
        min-height: 200px;
      }

      #highlighting {
        position: absolute;
        inset: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        overflow: auto;
        pointer-events: none;
        white-space: pre;
        tab-size: 4;
        background: linear-gradient(180deg, #fffefb, #f8fbff);
      }

      #highlighting-content {
        display: block;
        min-height: 100%;
        margin: 0;
        font-family: "Courier New", Courier, monospace;
        font-size: 0.98rem;
        line-height: 1.5;
        color: var(--text);
      }

      .token-keyword {
        color: #0057b8;
        font-weight: 700;
      }

      .token-string {
        color: #8b5b00;
      }

      .token-number {
        color: #0b7769;
      }

      .token-comment {
        color: #596576;
        font-style: italic;
      }

      .token-builtin {
        color: #a7162f;
      }

      .actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
      }

      #run,
      #clear-output {
        border: 1px solid transparent;
        border-radius: 12px;
        padding: 10px 17px;
        font-size: 0.94rem;
        font-weight: 700;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
      }

      #run {
        color: #ffffff;
        background: linear-gradient(140deg, var(--accent), var(--accent-strong));
        box-shadow: 0 10px 20px rgba(6, 74, 103, 0.25);
      }

      #clear-output {
        color: var(--text);
        background: #eef4fb;
        border-color: #d8e3ef;
      }

      #run:hover,
      #clear-output:hover {
        transform: translateY(-1px);
      }

      #run:active,
      #clear-output:active {
        transform: translateY(0);
      }

      #run:disabled {
        opacity: 0.68;
        cursor: progress;
        transform: none;
      }

      #output {
        margin: 0;
        height: auto;
        min-height: 180px;
        flex: 1;
        overflow: auto;
        padding: 12px;
        border: 1px solid #cddceb;
        border-radius: 12px;
        background: linear-gradient(180deg, #fbfdff, var(--panel-2));
        font-family: "Courier New", Courier, monospace;
        line-height: 1.45;
        white-space: pre-wrap;
      }

      #output.error {
        color: var(--error);
        background: #fff3f3;
        border-color: #efc6c6;
      }

      @keyframes rise-in {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 760px) {
        .app-header {
          width: calc(100% - 24px);
          padding: 16px 0 6px;
        }

        .app-title {
          font-size: clamp(1.35rem, 6.7vw, 1.7rem);
        }

        .layout {
          width: calc(100% - 24px);
          grid-template-rows: auto auto;
          min-height: auto;
        }

        .panel {
          padding: 12px;
        }

        .code-editor,
        #output {
          min-height: 280px;
        }
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <p class="app-kicker">Canlı Kod Atölyesi</p>
      <h1 class="app-title">Gokuta Python Eğitim Editörü</h1>
    </header>
    <main class="layout">
      <section class="panel editor-panel">
        <h2>Python Kod Alanı</h2>
        <p class="hint">Yukarıdaki alana kod yazıp aşağıdaki butonla çalıştırabilirsin.</p>
        <div class="editor-body">
          <div class="code-editor">
            <pre id="highlighting" aria-hidden="true"><code id="highlighting-content"></code></pre>
            <textarea id="code" spellcheck="false">
print("Gökçe KIRCALI")
            </textarea>
          </div>
          <div class="actions">
            <button id="run" type="button">Çalıştır</button>
          </div>
        </div>
      </section>

      <section class="panel output-panel">
        <h2>Çıktı</h2>
        <div class="output-body">
          <pre id="output">Sonuç burada görünecek.</pre>
          <div class="actions">
            <button id="clear-output" type="button">Temizle</button>
          </div>
        </div>
      </section>
    </main>

    <script>
      const codeInput = document.getElementById("code");
      const highlighting = document.getElementById("highlighting");
      const highlightingContent = document.getElementById("highlighting-content");
      const runButton = document.getElementById("run");
      const clearOutputButton = document.getElementById("clear-output");
      const output = document.getElementById("output");

      function escapeHtml(value) {
        return value
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      function highlightPythonCode(source) {
        let html = escapeHtml(source);
        const placeholders = [];

        const protect = (regex, className) => {
          html = html.replace(regex, (match) => {
            const token = `__PY_TOKEN_${placeholders.length}__`;
            placeholders.push(`<span class="${className}">${match}</span>`);
            return token;
          });
        };

        protect(
          /("""[\s\S]*?"""|'''[\s\S]*?'''|"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*')/g,
          "token-string"
        );
        protect(/(#.*)$/gm, "token-comment");

        html = html.replace(
          /\b(False|None|True|and|as|assert|async|await|break|class|continue|def|del|elif|else|except|finally|for|from|global|if|import|in|is|lambda|nonlocal|not|or|pass|raise|return|try|while|with|yield)\b/g,
          '<span class="token-keyword">$1</span>'
        );
        html = html.replace(
          /\b(print|range|len|input|int|float|str|list|dict|set|tuple|bool|enumerate|sum|min|max)\b/g,
          '<span class="token-builtin">$1</span>'
        );
        html = html.replace(/\b(\d+(?:\.\d+)?)\b/g, '<span class="token-number">$1</span>');
        html = html.replace(/__PY_TOKEN_(\d+)__/g, (_match, idx) => placeholders[Number(idx)]);

        if (html.endsWith("\n")) {
          html += " ";
        }

        return html;
      }

      function syncEditorScroll() {
        highlighting.scrollTop = codeInput.scrollTop;
        highlighting.scrollLeft = codeInput.scrollLeft;
      }

      function renderHighlighting() {
        highlightingContent.innerHTML = highlightPythonCode(codeInput.value);
        syncEditorScroll();
      }

      async function runCode() {
        const code = codeInput.value;
        runButton.disabled = true;
        output.classList.remove("error");
        output.textContent = "Kod çalıştırılıyor...";

        try {
          const response = await fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          });

          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || "İstek başarısız.");
          }

          if (data.ok) {
            output.classList.remove("error");
            output.textContent = data.output;
          } else {
            output.classList.add("error");
            const lines = [];
            if (data.output) lines.push(data.output);
            if (data.error) lines.push(data.error);
            output.textContent = lines.join("\n\n") || "Bir hata oluştu.";
          }
        } catch (error) {
          output.classList.add("error");
          output.textContent = `Hata: ${error.message}`;
        } finally {
          runButton.disabled = false;
        }
      }

      runButton.addEventListener("click", runCode);
      codeInput.addEventListener("input", renderHighlighting);
      codeInput.addEventListener("scroll", syncEditorScroll);
      codeInput.addEventListener("keydown", (event) => {
        if (event.key !== "Tab") return;
        event.preventDefault();
        const start = codeInput.selectionStart;
        const end = codeInput.selectionEnd;
        const value = codeInput.value;
        codeInput.value = `${value.slice(0, start)}    ${value.slice(end)}`;
        codeInput.selectionStart = codeInput.selectionEnd = start + 4;
        renderHighlighting();
      });
      clearOutputButton.addEventListener("click", () => {
        output.classList.remove("error");
        output.textContent = "Sonuç burada görünecek.";
      });
      codeInput.value = codeInput.value.replace(/^\n/, "").replace(/\n\s*$/, "");
      renderHighlighting();
    </script>
  </body>
</html>
